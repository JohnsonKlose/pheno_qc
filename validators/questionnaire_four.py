"""Validators for Questionnaire 4 related features.

Auto-generated from dingmap.csv (cclass2 == "问卷-4").
- factor: value must be a non-empty string after stripping whitespace.
- numeric: semantic range; menarche age constrained to 5-30 years.
"""

from typing import Dict, Tuple
import math

FACTOR_PHENOS = [
    "健康问卷调查-问卷-4:你为皮肤护理每周投入时间是",
    "健康问卷调查-问卷-4:你头皮的头皮屑程度是",
    "健康问卷调查-问卷-4:你家宠物种类是",
    "健康问卷调查-问卷-4:你对自己头发的印象是",
    "健康问卷调查-问卷-4:你平时使用面部化妆品吗",
    "健康问卷调查-问卷-4:你洗头发的平均频率是",
    "健康问卷调查-问卷-4:你洗澡时一般使用的是",
    "健康问卷调查-问卷-4:你觉得你的皮肤属于哪个类型",
    "健康问卷调查-问卷-4:你觉得自己看起来",
    "健康问卷调查-问卷-4:你认为自己有狐臭吗",
    "健康问卷调查-问卷-4:你认为自己的脚有异味吗",
    "健康问卷调查-问卷-4:出现鼻塞、流涕、喷嚏和鼻痒其中一个以上的症状时，您通常会如何处理",
    "健康问卷调查-问卷-4:刷牙时您是否曾出现过出血的情况",
    "健康问卷调查-问卷-4:夏天出门时你使用防晒用品吗",
    "健康问卷调查-问卷-4:夏天沐浴频率",
    "健康问卷调查-问卷-4:如果有熬夜情况，熬夜原因有哪些",
    "健康问卷调查-问卷-4:居住地和学校周围的粉尘，屋尘现象怎么样",
    "健康问卷调查-问卷-4:平时洗脸时",
    "健康问卷调查-问卷-4:当你购买化妆品时最关注的是",
    "健康问卷调查-问卷-4:当您出现鼻塞、流涕、喷嚏和鼻痒其中一个以上的症状时，它(们)对您的生活有什么影响",
    "健康问卷调查-问卷-4:您从多少岁开始刷牙",
    "健康问卷调查-问卷-4:您会区分感冒和鼻炎吗",
    "健康问卷调查-问卷-4:您会在刷完牙，睡觉前吃东西吗",
    "健康问卷调查-问卷-4:您刷牙的主要方式是",
    "健康问卷调查-问卷-4:您在过去2周内大便规律是否有改变",
    "健康问卷调查-问卷-4:您在过去一周内是否发生过腹泻",
    "健康问卷调查-问卷-4:您在过去的一周内平均每天排便多少次",
    "健康问卷调查-问卷-4:您在过去的一周内是否便秘",
    "健康问卷调查-问卷-4:您在过去的一周内是否感到腹胀",
    "健康问卷调查-问卷-4:您在过去的一周内是否有胃胀气",
    "健康问卷调查-问卷-4:您在过去的一周内，排便后是否有排空感觉",
    "健康问卷调查-问卷-4:您在过去的一周内，胃肠有隆隆声",
    "健康问卷调查-问卷-4:您多久更换牙刷",
    "健康问卷调查-问卷-4:您平时会有眼部不适吗",
    "健康问卷调查-问卷-4:您平时会有鼻子不适吗",
    "健康问卷调查-问卷-4:您平时会用手指挖鼻孔吗",
    "健康问卷调查-问卷-4:您平时月经是否规律？",
    "健康问卷调查-问卷-4:您平时有耳朵不适吗",
    "健康问卷调查-问卷-4:您患有哪些鼻部或呼吸道疾病",
    "健康问卷调查-问卷-4:您是否会定期做口腔检查",
    "健康问卷调查-问卷-4:您是否做过窝沟封闭",
    "健康问卷调查-问卷-4:您是否出现过口腔溃疡",
    "健康问卷调查-问卷-4:您是否出现过蛀牙",
    "健康问卷调查-问卷-4:您是否存在口臭",
    "健康问卷调查-问卷-4:您是否存在牙列不齐",
    "健康问卷调查-问卷-4:您是否已经绝经？",
    "健康问卷调查-问卷-4:您是否接受过乳房肿块/肿瘤切除手术：",
    "健康问卷调查-问卷-4:您是否接受过卵巢(单侧或双侧)摘除术：",
    "健康问卷调查-问卷-4:您是否接受过子宫切除术？",
    "健康问卷调查-问卷-4:您是否曾经怀孕？",
    "健康问卷调查-问卷-4:您是否曾采取方法进行避孕：",
    "健康问卷调查-问卷-4:您是否有饭后漱口的习惯",
    "健康问卷调查-问卷-4:您有以下肺部症状吗",
    "健康问卷调查-问卷-4:您有午睡的习惯吗",
    "健康问卷调查-问卷-4:您每天使用电子产品的时间为",
    "健康问卷调查-问卷-4:您每天刷牙几次",
    "健康问卷调查-问卷-4:您现在使用的牙膏是",
    "健康问卷调查-问卷-4:您生活的交际圈里面，有抽烟习惯的人多吗",
    "健康问卷调查-问卷-4:您的家人有没有鼻炎症状的患病情况",
    "健康问卷调查-问卷-4:您的居住地和学校是否靠近交通干道",
    "健康问卷调查-问卷-4:您的居住地和学校附近有没有对空气污染影响比较大的工厂",
    "健康问卷调查-问卷-4:您的平均刷牙时长是",
    "健康问卷调查-问卷-4:您的粪便性状是否有改变",
    "健康问卷调查-问卷-4:您的粪便颜色是否有改变",
    "健康问卷调查-问卷-4:您第一次出现鼻部不适或鼻炎症状是什么时候呢",
    "健康问卷调查-问卷-4:您觉得自己的嗅觉水平如何",
    "健康问卷调查-问卷-4:是否有过性生活",
    "健康问卷调查-问卷-4:沐浴时，你一般使用",
    "健康问卷调查-问卷-4:洗发时只洗头发还是也有意洗头皮",
    "健康问卷调查-问卷-4:第一次怀孕的结果？",
    "健康问卷调查-问卷-4:若是，采取的避孕方法为",
    "健康问卷调查-问卷-4:请您仔细想一下，您的鼻部不适一般会在哪个季节出现呢",
    "健康问卷调查-问卷-4:请选出符合自身情况的选项",
    "健康问卷调查-问卷-4:请问您平时工作或生活环境中可以接触到农场动物吗",
    "健康问卷调查-问卷-4:请问您的鼻部不适发作时会同时出现以下哪些症状",
    "健康问卷调查-问卷-4:过去一周内，您有几天晚于十二点睡",
    "健康问卷调查-问卷-4:过去两天，您是否有过性生活",
    "健康问卷调查-问卷-4:通常在以下哪些情况下会出现鼻塞，流涕、喷嚏和鼻痒其中一个以上的症状",
]

NUMERIC_BOUNDS: Dict[str, Tuple[float, float]] = {
    "健康问卷调查-问卷-4:您第一次月经来潮是：": (5.0, 30.0),
}


def register(registry, prefix_registry):
    for pheno in FACTOR_PHENOS:
        registry[pheno] = _validate_factor_non_empty

    for pheno, (lower, upper) in NUMERIC_BOUNDS.items():
        registry[pheno] = _build_numeric_validator(lower, upper)


def _build_numeric_validator(lower: float, upper: float):
    def _validator(feature_key, final_value, payload) -> bool:
        return _validate_numeric_range(final_value, lower, upper)
    return _validator


def _validate_numeric_range(final_value, lower: float, upper: float) -> bool:
    try:
        value = float(final_value)
    except (TypeError, ValueError):
        return False

    if not math.isfinite(value):
        return False
    return lower <= value <= upper


def _validate_factor_non_empty(feature_key, final_value, payload) -> bool:
    if final_value is None:
        return False
    if isinstance(final_value, str):
        return final_value.strip() != ""
    return False
