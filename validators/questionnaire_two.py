"""Validators for Questionnaire 2 related features.

Auto-generated from dingmap.csv (cclass2 == "问卷-2").
- factor: value must be a non-empty string after stripping whitespace.
- numeric: must be finite within [lower, upper]; upper derived from semantic-friendly heuristic (10x mean, ensuring >= sample max).
"""

from typing import Dict, Tuple
import math

FACTOR_PHENOS = [
    "健康问卷调查-问卷-2:100%纯果汁食用频率",
    "健康问卷调查-问卷-2:一天中会吃午饭的频率",
    "健康问卷调查-问卷-2:一天中会吃早饭的频率",
    "健康问卷调查-问卷-2:一天中会吃晚饭的频率",
    "健康问卷调查-问卷-2:上午5点~上午9点食量",
    "健康问卷调查-问卷-2:上午9点~下午1点食量",
    "健康问卷调查-问卷-2:上述食物外，您还经常吃什么食物频率",
    "健康问卷调查-问卷-2:下午1点~下午5点食量",
    "健康问卷调查-问卷-2:下午5点~晚上9点食量",
    "健康问卷调查-问卷-2:仁果类(苹果、梨等)食用频率",
    "健康问卷调查-问卷-2:代糖或低糖饮料(添加糖醇、甜味剂等饮料)食用频率",
    "健康问卷调查-问卷-2:低脂奶粉食用频率",
    "健康问卷调查-问卷-2:低脂牛奶食用频率",
    "健康问卷调查-问卷-2:全脂牛奶食用频率",
    "健康问卷调查-问卷-2:其他主食(请注明)食用频率",
    "健康问卷调查-问卷-2:其他加工肉类食用频率",
    "健康问卷调查-问卷-2:其他坚果(请说明)食用频率",
    "健康问卷调查-问卷-2:其他果汁食用频率",
    "健康问卷调查-问卷-2:其他水果(芒果、香蕉、菠萝、荔枝)食用频率",
    "健康问卷调查-问卷-2:其他油类食用频率",
    "健康问卷调查-问卷-2:其他烹饪方法频率",
    "健康问卷调查-问卷-2:其他营养补充剂(请注明)食用频率",
    "健康问卷调查-问卷-2:其他蛋奶制品(请注明)食用频率",
    "健康问卷调查-问卷-2:其他饮料(请说明)食用频率",
    "健康问卷调查-问卷-2:其它蔬菜(豆角、茭白、秋葵等)食用频率",
    "健康问卷调查-问卷-2:冰淇淋食用频率",
    "健康问卷调查-问卷-2:加工肉制品(香肠、火腿肠、午餐肉等)食用频率",
    "健康问卷调查-问卷-2:加工蛋类(咸蛋、皮蛋等)食用频率",
    "健康问卷调查-问卷-2:动物内脏(心、脑、舌、肾、肚、肠等)食用频率",
    "健康问卷调查-问卷-2:十字花科类(白菜、菜花、西兰花、甘蓝、卷心菜等)食用频率",
    "健康问卷调查-问卷-2:可乐等碳水饮料食用频率",
    "健康问卷调查-问卷-2:味精食用频率",
    "健康问卷调查-问卷-2:咸鱼及其他加工鱼制品食用频率",
    "健康问卷调查-问卷-2:块根类(莲藕、山药、竹笋、白萝卜、荸荠、芦笋等)食用频率",
    "健康问卷调查-问卷-2:坚果(花生、瓜子、栗子、核桃等)食用频率",
    "健康问卷调查-问卷-2:复合维生素食用频率",
    "健康问卷调查-问卷-2:大米及制品(精米饭、米粉等)食用频率",
    "健康问卷调查-问卷-2:大豆类(黄豆、青豆、黑豆、毛豆、扁豆、豇豆、蚕豆等)食用频率",
    "健康问卷调查-问卷-2:奶茶食用频率",
    "健康问卷调查-问卷-2:奶酪食用频率",
    "健康问卷调查-问卷-2:您晚上睡觉前还会吃多少食物",
    "健康问卷调查-问卷-2:晚上9点~凌晨1点食量",
    "健康问卷调查-问卷-2:柑橘类水果(橙子、柚子、桔子等)食用频率",
    "健康问卷调查-问卷-2:核果类(桃、李、枇杷、枣、杏等)食用频率",
    "健康问卷调查-问卷-2:橄榄油食用频率",
    "健康问卷调查-问卷-2:水果干食用频率",
    "健康问卷调查-问卷-2:油炸烹饪方法频率",
    "健康问卷调查-问卷-2:油炸面食(油条\油饼等)食用频率",
    "健康问卷调查-问卷-2:油豆腐、豆腐干及除新鲜豆腐外的各种豆制品食用频率",
    "健康问卷调查-问卷-2:浆果类(草莓、蓝莓、葡萄等)食用频率",
    "健康问卷调查-问卷-2:海产品菌藻(紫菜、海带、_发菜、_苔菜等)食用频率",
    "健康问卷调查-问卷-2:海鱼(如带鱼、黄鱼等)食用频率",
    "健康问卷调查-问卷-2:淡水鱼(如草鱼、扁鱼、鲫鱼等)食用频率",
    "健康问卷调查-问卷-2:深绿叶类(青菜、菠菜、油麦菜、空心菜、生菜等)食用频率",
    "健康问卷调查-问卷-2:深黄、橙及红色蔬菜(胡萝卜、西红柿、南瓜等)食用频率",
    "健康问卷调查-问卷-2:温开水、矿泉水食用频率",
    "健康问卷调查-问卷-2:烧烤烹饪方法频率",
    "健康问卷调查-问卷-2:煎炒烹饪方法频率",
    "健康问卷调查-问卷-2:煮烹饪方法频率",
    "健康问卷调查-问卷-2:猪、牛、羊等动物肝脏食用频率",
    "健康问卷调查-问卷-2:猪油食用频率",
    "健康问卷调查-问卷-2:瓜类(黄瓜、冬瓜、丝瓜、西葫芦、佛手瓜、苦瓜等)食用频率",
    "健康问卷调查-问卷-2:瓜类水果(西瓜、甜瓜等)食用频率",
    "健康问卷调查-问卷-2:生食烹饪方法频率",
    "健康问卷调查-问卷-2:盐食用频率",
    "健康问卷调查-问卷-2:禽类肉(鸡、鸭、鹅肉等)食用频率",
    "健康问卷调查-问卷-2:粗粮类(糙米饭、玉米、小米、高粱等)食用频率",
    "健康问卷调查-问卷-2:糕点(面包、饼干、蛋糕、绿豆糕、蛋黄酥、月饼等)食用频率",
    "健康问卷调查-问卷-2:糖(红、白糖)食用频率",
    "健康问卷调查-问卷-2:糖果蜜饯_食用频率",
    "健康问卷调查-问卷-2:维生素C(一份400_mg)食用频率",
    "健康问卷调查-问卷-2:维生素D_(一份300_IU)食用频率",
    "健康问卷调查-问卷-2:罐装水果/水果罐头食用频率",
    "健康问卷调查-问卷-2:腌菜(腌萝卜、腌黄瓜、泡菜等)食用频率",
    "健康问卷调查-问卷-2:花生油食用频率",
    "健康问卷调查-问卷-2:茄果类(茄子、青椒/甜椒、小辣椒等)食用频率",
    "健康问卷调查-问卷-2:茎类(芹菜、莴笋、菜苔等)食用频率",
    "健康问卷调查-问卷-2:菜籽油食用频率",
    "健康问卷调查-问卷-2:葱蒜类(洋葱、葱、蒜、韭菜、蒜苔、蒜黄等)食用频率",
    "健康问卷调查-问卷-2:蒸烹饪方法频率",
    "健康问卷调查-问卷-2:薯类(土豆、地瓜、芋头等)食用频率",
    "健康问卷调查-问卷-2:蘑菇类(金针菇、香菇、平菇、茶树菇、鸡腿菇等)食用频率",
    "健康问卷调查-问卷-2:虾、蟹类食用频率",
    "健康问卷调查-问卷-2:螺类及其他软体动物类(鱿鱼、海蜇等)食用频率",
    "健康问卷调查-问卷-2:请问您吃饭时还有哪些习惯",
    "健康问卷调查-问卷-2:豆油_食用频率",
    "健康问卷调查-问卷-2:豆浆、豆奶食用频率",
    "健康问卷调查-问卷-2:豆芽(黄豆芽、绿豆芽等)食用频率",
    "健康问卷调查-问卷-2:过去一个月，有没有暴饮暴食的情况",
    "健康问卷调查-问卷-2:酱油食用频率",
    "健康问卷调查-问卷-2:酸奶食用频率",
    "健康问卷调查-问卷-2:醋食用频率",
    "健康问卷调查-问卷-2:钙(一份300_mg)食用频率",
    "健康问卷调查-问卷-2:除了早中晚餐，有没有其他规律的进餐习惯",
    "健康问卷调查-问卷-2:面制品类(面条、馒头等)食用频率",
    "健康问卷调查-问卷-2:食物类型油炸食物频率",
    "健康问卷调查-问卷-2:食用菌非蘑菇类(木耳、银耳等)食用频率",
    "健康问卷调查-问卷-2:饮食口味咸度",
    "健康问卷调查-问卷-2:饮食口味油腻程度",
    "健康问卷调查-问卷-2:饮食口味温度",
    "健康问卷调查-问卷-2:饮食口味甜度",
    "健康问卷调查-问卷-2:饮食口味辣度",
    "健康问卷调查-问卷-2:饮食地点外卖频率",
    "健康问卷调查-问卷-2:饮食地点家中(剩饭剩菜)频率",
    "健康问卷调查-问卷-2:饮食地点家中(新鲜)频率",
    "健康问卷调查-问卷-2:饮食地点食堂频率",
    "健康问卷调查-问卷-2:饮食地点饭店频率",
    "健康问卷调查-问卷-2:高脂奶粉食用频率",
    "健康问卷调查-问卷-2:鱼油_食用频率",
    "健康问卷调查-问卷-2:鲜牛羊肉食用频率",
    "健康问卷调查-问卷-2:鲜猪肉食用频率",
    "健康问卷调查-问卷-2:鲜豆腐食用频率",
    "健康问卷调查-问卷-2:鲜鸡蛋、鸭蛋等食用频率",
    "健康问卷调查-问卷-2:黄油食用频率",
    "健康问卷调查-问卷-2:黄鳝、泥鳅食用频率",
]

NUMERIC_BOUNDS: Dict[str, Tuple[float, float]] = {
    "健康问卷调查-问卷-2:MUFA(日均摄入量)": (0.000000, 200.273864),
    "健康问卷调查-问卷-2:PUFA(日均摄入量)": (0.000000, 89.223741),
    "健康问卷调查-问卷-2:SFA(日均摄入量)": (0.000000, 177.359225),
    "健康问卷调查-问卷-2:Tota1_vite_mg(日均摄入量)(mg)": (0.000000, 244.432920),
    "健康问卷调查-问卷-2:Total(日均摄入量)": (0.000000, 473.528283),
    "健康问卷调查-问卷-2:energy_kca1(日均摄入量)": (0.000000, 17428.958957),
    "健康问卷调查-问卷-2:不溶性膳食纤维(Dietary_fiber)g(日均摄入量)(g)": (0.000000, 210.711545),
    "健康问卷调查-问卷-2:总维生素_A(Vitamin_A)_ugRAE(日均摄入量)(ug)": (0.000000, 24153.493079),
    "健康问卷调查-问卷-2:核黄素(Ribof1avin)mg(日均摄入量)(mg)": (0.000000, 20.934204),
    "健康问卷调查-问卷-2:水分(Water)g(日均摄入量)(g)": (0.000000, 6223.252357),
    "健康问卷调查-问卷-2:烟酸(Niacin)mg(日均摄入量)(mg)": (0.000000, 210.231655),
    "健康问卷调查-问卷-2:硒(Se)Rg(日均摄入量)(Rg)": (0.000000, 669.514059),
    "健康问卷调查-问卷-2:硫胺素(Thiamin)mg(日均摄入量)(mg)": (0.000000, 10.440021),
    "健康问卷调查-问卷-2:碳水化合物(CHO)g(日均摄入量)(g)": (0.000000, 2084.274450),
    "健康问卷调查-问卷-2:磷(P)mg(日均摄入量)(mg)": (0.000000, 16555.455070),
    "健康问卷调查-问卷-2:维生素c(Vitamin_C)mg(日均摄入量)(mg)": (0.000000, 768.486293),
    "健康问卷调查-问卷-2:胆固醇(Cho1estero1)mg(日均摄入量)(mg)": (0.000000, 9144.988176),
    "健康问卷调查-问卷-2:胡萝卜素(Carotene)ug(日均摄入量)(ug)": (0.000000, 18768.176752),
    "健康问卷调查-问卷-2:脂肪(Fat)g(日均摄入量)(g)": (0.000000, 632.410301),
    "健康问卷调查-问卷-2:蛋白质(Protein)g(日均摄入量)(g)": (0.000000, 992.153164),
    "健康问卷调查-问卷-2:视黄醇(Retino1)ug(日均摄入量)(ug)": (0.000000, 20285.351572),
    "健康问卷调查-问卷-2:钙(Ca)mg(日均摄入量)(mg)": (0.000000, 9729.780506),
    "健康问卷调查-问卷-2:钠(Na)mg(日均摄入量)(mg)": (0.000000, 13390.421171),
    "健康问卷调查-问卷-2:钾(K)mg(日均摄入量)(mg)": (0.000000, 27175.326129),
    "健康问卷调查-问卷-2:铁(Fe)mg(日均摄入量)(mg)": (0.000000, 475.074982),
    "健康问卷调查-问卷-2:铜(Cu)mg(日均摄入量)(mg)": (0.000000, 28.856216),
    "健康问卷调查-问卷-2:锌(Zn)mg(日均摄入量)(mg)": (0.000000, 146.898641),
    "健康问卷调查-问卷-2:锰(Mn)mg(日均摄入量)(mg)": (0.000000, 55.353308),
    "健康问卷调查-问卷-2:镁(Mg)mg(日均摄入量)(mg)": (0.000000, 3810.888105),
}


def register(registry, prefix_registry):
    for pheno in FACTOR_PHENOS:
        registry[pheno] = _validate_factor_non_empty

    for pheno, (lower, upper) in NUMERIC_BOUNDS.items():
        registry[pheno] = _build_numeric_validator(lower, upper)


def _build_numeric_validator(lower: float, upper: float):
    def _validator(feature_key, final_value, payload) -> bool:
        return _validate_numeric_range(final_value, lower, upper)
    return _validator


def _validate_numeric_range(final_value, lower: float, upper: float) -> bool:
    try:
        value = float(final_value)
    except (TypeError, ValueError):
        return False

    if not math.isfinite(value):
        return False
    return lower <= value <= upper


def _validate_factor_non_empty(feature_key, final_value, payload) -> bool:
    if final_value is None:
        return False
    if isinstance(final_value, str):
        return final_value.strip() != ""
    return False
