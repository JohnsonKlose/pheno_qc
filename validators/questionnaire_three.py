"""Validators for Questionnaire 3 related features.

Auto-generated from dingmap.csv (cclass2 == "问卷-3").
- factor: value must be a non-empty string after stripping whitespace.
- numeric: finite values within semantic ranges (days/week, 0-100 scores, minutes/day, or hours/day capped at 24).
"""

from typing import Dict, Tuple
import math

FACTOR_PHENOS = [
    "健康问卷调查-问卷-3:低聚果糖食用频数",
    "健康问卷调查-问卷-3:其它保健品食用频数",
    "健康问卷调查-问卷-3:医疗费用支付方式",
    "健康问卷调查-问卷-3:同胞性别",
    "健康问卷调查-问卷-3:和同龄人相对比健康状况",
    "健康问卷调查-问卷-3:在日常生活中您需要的信息都齐备吗",
    "健康问卷调查-问卷-3:在过去7天中，我有没有几天在院子里进行中等强度体力活动，如搬(举)轻物，扫院子？(只计算那些每次至少10分钟的活动)",
    "健康问卷调查-问卷-3:在过去7天中，我有没有几天在院子里进行重体力活动，例如搬(举)重物？(只计算那些每次至少10分钟的活动)",
    "健康问卷调查-问卷-3:在过去7天中，我有没有几天步行每次至少10分钟？",
    "健康问卷调查-问卷-3:在过去7天中，我有没有几天闲暇时进行中等强度体力活动，如打太极拳、打乒乓球，打羽毛球，跳交谊舞等？(只计算那些每次至少10分钟的活动)",
    "健康问卷调查-问卷-3:在过去7天中，我有没有几天骑自行车每次至少10分钟？",
    "健康问卷调查-问卷-3:在过去7天内，您有没有参加了重体力活动的体育锻炼(如有氧健身、跑步、快速骑车、游泳及_足球、篮球类活动等)且持续时间超过10分钟",
    "健康问卷调查-问卷-3:在过去7天内，您有没有外出散步，且持续时间超过10分钟？",
    "健康问卷调查-问卷-3:复合维生素食用频数",
    "健康问卷调查-问卷-3:如使用过抗生素，最近1次在何时使用",
    "健康问卷调查-问卷-3:家庭摩擦影响您的生活吗",
    "健康问卷调查-问卷-3:您在过去半年内使用过抗生素吗",
    "健康问卷调查-问卷-3:您对其他成分过敏吗",
    "健康问卷调查-问卷-3:您对化妆品过敏吗",
    "健康问卷调查-问卷-3:您对得到卫生保健服务的方便程度满意吗",
    "健康问卷调查-问卷-3:您对抗生素过敏吗",
    "健康问卷调查-问卷-3:您对昆虫接触性过敏吗",
    "健康问卷调查-问卷-3:您对禽畜过敏吗",
    "健康问卷调查-问卷-3:您对自己从朋友那里得到的支持满意吗",
    "健康问卷调查-问卷-3:您对自己做日常生活事情的能力满意吗",
    "健康问卷调查-问卷-3:您对自己居住地的条件满意吗",
    "健康问卷调查-问卷-3:您对自己满意吗",
    "健康问卷调查-问卷-3:您对自己的交通情况满意吗",
    "健康问卷调查-问卷-3:您对自己的人际关系满意吗",
    "健康问卷调查-问卷-3:您对自己的健康状况满意吗",
    "健康问卷调查-问卷-3:您对自己的工作能力满意吗",
    "健康问卷调查-问卷-3:您对自己的性生活满意吗",
    "健康问卷调查-问卷-3:您对自己的睡眠情况满意吗",
    "健康问卷调查-问卷-3:您对花粉过敏吗",
    "健康问卷调查-问卷-3:您对菌菇类接触性过敏吗",
    "健康问卷调查-问卷-3:您对金属过敏吗",
    "健康问卷调查-问卷-3:您对阳光过敏吗",
    "健康问卷调查-问卷-3:您对除抗生素外的其他药物过敏吗",
    "健康问卷调查-问卷-3:您对除花粉外的植物接触性过敏吗",
    "健康问卷调查-问卷-3:您对食品添加剂过敏吗",
    "健康问卷调查-问卷-3:您怎样评价您的生活质量",
    "健康问卷调查-问卷-3:您是否在医院出生",
    "健康问卷调查-问卷-3:您是否是早产儿",
    "健康问卷调查-问卷-3:您是否曾接受手术",
    "健康问卷调查-问卷-3:您有充沛的精力去应付日常生活吗",
    "健康问卷调查-问卷-3:您有机会进行休闲活动吗",
    "健康问卷调查-问卷-3:您有消极感受吗?_(如情绪低落、绝望、焦虑、忧郁)",
    "健康问卷调查-问卷-3:您的出生方式",
    "健康问卷调查-问卷-3:您的生活环境对健康好吗",
    "健康问卷调查-问卷-3:您的钱够用吗",
    "健康问卷调查-问卷-3:您的食欲怎么样",
    "健康问卷调查-问卷-3:您目前是否外出工作",
    "健康问卷调查-问卷-3:您能集中注意力吗",
    "健康问卷调查-问卷-3:您行动的能力如何",
    "健康问卷调查-问卷-3:您觉得生活有乐趣吗",
    "健康问卷调查-问卷-3:您觉得疼痛妨碍您去做自己需要做的事情吗",
    "健康问卷调查-问卷-3:您觉得自己的生活有意义吗",
    "健康问卷调查-问卷-3:您认为您是过敏体质吗",
    "健康问卷调查-问卷-3:您认为您目前的健康状况如何",
    "健康问卷调查-问卷-3:您认为自己的外形过得去吗",
    "健康问卷调查-问卷-3:您需要依靠医疗的帮助进行日常生活吗",
    "健康问卷调查-问卷-3:您食用某些食物会发生过敏吗",
    "健康问卷调查-问卷-3:手术类型",
    "健康问卷调查-问卷-3:抗生素最近1次使用的持续时间是",
    "健康问卷调查-问卷-3:抗生素最近1次使用的频率",
    "健康问卷调查-问卷-3:日常生活中您感觉安全吗",
    "健康问卷调查-问卷-3:最近1次使用抗生素的种类",
    "健康问卷调查-问卷-3:活菌制剂药物或益生菌粉食用频数",
    "健康问卷调查-问卷-3:疾病史初次确诊年龄",
    "健康问卷调查-问卷-3:疾病史疾病编码",
    "健康问卷调查-问卷-3:维生素C食用频数",
    "健康问卷调查-问卷-3:维生素D食用频数",
    "健康问卷调查-问卷-3:菊粉食用频数",
    "健康问卷调查-问卷-3:蛋白粉食用频数",
    "健康问卷调查-问卷-3:过去7天中，我有没有几天乘机动车，如火车、地铁、公共汽车、电车、轿车(出租车)？",
    "健康问卷调查-问卷-3:过去7天中，我有没有在工作中每次步行至少10分钟？不要包括上下班路上的步行。",
    "健康问卷调查-问卷-3:过去7天中，我有没有在工作中进行中等强度体力活动，例如搬(举)轻物？不要包括走路。(只计算那些每次至少10分钟的活动)",
    "健康问卷调查-问卷-3:过去7天中，我有没有在工作中进行重体力活动，例如搬(举)重物，挖掘，铲土，装卸货物、上楼梯等？(只计算那些每次至少10分钟的活动)",
    "健康问卷调查-问卷-3:通常情况下，您排便频率为",
    "健康问卷调查-问卷-3:酵素食用频数",
]

NUMERIC_BOUNDS: Dict[str, Tuple[float, float]] = {
    "健康问卷调查-问卷-3:在工作中每天花多长时间步行(小时/天)T3(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在工作中每天花多长时间进行重体力活动(小时/天)T1(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在工作中，每天花多长时间进行中度体力活动(小时/天)T2(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天中，我有几天步行每次至少10分钟？": (0.000000, 7.000000),
    "健康问卷调查-问卷-3:在过去7天内，您周末或休息日每天花在坐姿状态中的时间是多少(小时)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您周末或休息日每天花在坐姿状态中的时间是多少(小时/天)T13(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您在周末或休息日每天花在睡眠中的时间是多少(小时)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您在周末或休息日每天花在睡眠中的时间是多少(小时/天)T15(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您在工作日每天花在睡眠(包括午睡)中的时间是多少(小时)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您在工作日每天花在睡眠(包括午睡)中的时间是多少(小时/天)T14(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您工作日每天花在坐姿状态中的时间是多少(小时)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您工作日每天花在坐姿状态中的时间是多少(小时/天)T12(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:在过去7天内，您有几天外出散步，且持续时间超过10分钟？(多少天/周)": (0.000000, 7.000000),
    "健康问卷调查-问卷-3:如果让您综合以上各方面给自己的生存质量打一个总分,_您打多少分(满分为100分)": (0.000000, 100.000000),
    "健康问卷调查-问卷-3:每天乘车花多长时间(小时)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天乘车花多长时间(小时/天)T4(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天步行花多长时间(分钟)": (0.000000, 1440.000000),
    "健康问卷调查-问卷-3:每天步行花多长时间(小时/天)T6(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天花在散步中的时间是多少(小时/天)T9(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天花多长时间进行中度体力家务劳动(小时/天)T8(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天花多长时间进行中度体力活动体育锻炼？(小时/天)T11(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天花多长时间进行重体力家务劳动(小时/天)T7(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天花多长时间进行重体力活动体育锻炼？(小时/天)T10(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:每天骑自行车花多长时间(小时/天)T5(小时/天)": (0.000000, 24.000000),
    "健康问卷调查-问卷-3:过去7天中，我有几天乘机动车，如火车、地铁、公共汽车、电车、轿车(出租车)？": (0.000000, 7.000000),
}


def register(registry, prefix_registry):
    for pheno in FACTOR_PHENOS:
        registry[pheno] = _validate_factor_non_empty

    for pheno, (lower, upper) in NUMERIC_BOUNDS.items():
        registry[pheno] = _build_numeric_validator(lower, upper)


def _build_numeric_validator(lower: float, upper: float):
    def _validator(feature_key, final_value, payload) -> bool:
        return _validate_numeric_range(final_value, lower, upper)
    return _validator


def _validate_numeric_range(final_value, lower: float, upper: float) -> bool:
    try:
        value = float(final_value)
    except (TypeError, ValueError):
        return False

    if not math.isfinite(value):
        return False
    return lower <= value <= upper


def _validate_factor_non_empty(feature_key, final_value, payload) -> bool:
    if final_value is None:
        return False
    if isinstance(final_value, str):
        return final_value.strip() != ""
    return False
